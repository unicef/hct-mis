# Generated by Django 2.2.8 on 2020-06-18 10:26
import datetime

from django.db import migrations


def mark_as_sent(apps, schema_editor):
    DHHousehold = apps.get_model("mis_datahub", "Household")
    Household = apps.get_model("household", "Household")
    mis_ids = list(DHHousehold.objects.values_list("mis_id", flat=True))
    Household.objects.filter(id__in=mis_ids).update(
        last_sync_at=datetime.datetime.now()
    )


def reverse_mark(apps, schema_editor):
    DHHousehold = apps.get_model("mis_datahub", "Household")
    Household = apps.get_model("household", "Household")
    mis_ids = list(DHHousehold.objects.values_list("mis_id", flat=True))
    Household.objects.filter(id__in=mis_ids).update(last_sync_at=None)


class Migration(migrations.Migration):

    dependencies = [
        ("mis_datahub", "0001_migration"),
    ]

    operations = [
        migrations.RunPython(mark_as_sent, reverse_mark),
    ]
