# Generated by Django 2.2.8 on 2020-06-18 11:42

from django.db import migrations
from django.utils import timezone


def mark_as_sent(apps, schema_editor):
    DHProgram = apps.get_model("mis_datahub", "Program")
    Program = apps.get_model("program", "Program")
    mis_ids = list(DHProgram.objects.values_list("mis_id", flat=True))
    Program.objects.filter(id__in=mis_ids).update(last_sync_at=timezone.now())


def reverse_mark(apps, schema_editor):
    DHProgram = apps.get_model("mis_datahub", "Program")
    Program = apps.get_model("program", "Program")
    mis_ids = list(DHProgram.objects.values_list("mis_id", flat=True))
    Program.objects.filter(id__in=mis_ids).update(last_sync_at=None)


class Migration(migrations.Migration):

    dependencies = [
        ("mis_datahub", "0002_migration"),
        ("program", "0008_migration"),
    ]

    operations = [
        migrations.RunPython(mark_as_sent, reverse_mark),
    ]
