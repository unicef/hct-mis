# Generated by Django 3.2.15 on 2022-10-04 12:28

from django.contrib.contenttypes.models import ContentType
from django.db import migrations

def update_payment_record_fk(apps, schema_editor):
    PaymentVerification = apps.get_model("payment", "PaymentVerification")
    pv_to_upd = []

    content_type_for_payment_record, _ = (
        # need here 'get_or_create' for initdemo if db is empty
        ContentType.objects.get_or_create(app_label="payment", model="paymentrecord")
    )

    for pv in PaymentVerification.objects.all():
        if pv.payment_record:
            pv.payment_content_type_id = content_type_for_payment_record.id
            pv.payment_object_id = pv.payment_record_id
            pv_to_upd.append(pv)

    PaymentVerification.objects.bulk_update(pv_to_upd, ("payment_content_type_id", "payment_object_id"), 1000)

class Migration(migrations.Migration):

    dependencies = [
        ('payment', '0075_migration'),
    ]

    operations = [
        migrations.RunPython(update_payment_record_fk,)
    ]
