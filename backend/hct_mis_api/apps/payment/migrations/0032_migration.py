# Generated by Django 2.2.26 on 2022-02-11 14:22

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('payment', '0031_migration'),
    ]

    operations = [
        migrations.RunSQL("ALTER TABLE payment_cashplanpaymentverification ADD unicef_id_index SERIAL"),
        migrations.RunSQL("""
        CREATE OR REPLACE FUNCTION create_pvp_unicef_id() RETURNS trigger
            LANGUAGE plpgsql
            AS $$
        BEGIN
            NEW.unicef_id := format('PVP-%s', NEW.unicef_id_index);
            return NEW;
        END
        $$;
        
        CREATE TRIGGER create_pvp_unicef_id BEFORE INSERT ON payment_cashplanpaymentverification FOR EACH ROW EXECUTE PROCEDURE create_pvp_unicef_id();
        """),
        migrations.RunSQL(
            "UPDATE payment_cashplanpaymentverification SET unicef_id = format('PVP-%s', unicef_id_index)"
        )

    ]
