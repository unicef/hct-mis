# Generated by Django 2.2.16 on 2021-09-16 09:26

from django.db import migrations

from django_countries import countries


def initialise_geo(apps, schema_editor):
    Country = apps.get_model("geo", "Country")
    for c in countries:
        data = dict(name=c.name,
                    short_name=c.name,
                    iso_code3=countries.alpha3(c.code),
                    iso_num=str(countries.numeric(c.code)).rjust(4, '0'),
                    lft=0,
                    rght=0,
                    tree_id=0,
                    level=0, )
        Country.objects.get_or_create(iso_code2=c.code, defaults=data)


def rebuild(apps, schema_editor):
    from hct_mis_api.apps.geo.models import Country
    Country.objects.rebuild()


def empty_reverse(apps, schema_editor):
    Country = apps.get_model("geo", "Country")
    Country.objects.all().delete()


class Migration(migrations.Migration):
    dependencies = [
        ("geo", "0001_migration")
    ]

    operations = [
        migrations.RunPython(initialise_geo, empty_reverse),
        migrations.RunPython(rebuild, empty_reverse),
    ]
