# Generated by Django 2.2.8 on 2020-07-10 13:12

from django.db import migrations




class Migration(migrations.Migration):
    dependencies = [
        ("household", "0012_migration"),
    ]

    operations = [
        migrations.RunSQL(
            """
        CREATE OR REPLACE FUNCTION create_hh_unicef_id() RETURNS trigger
            LANGUAGE plpgsql
            AS $$
        begin
          NEW.unicef_id := format('HH-%s-%s',TO_CHAR(NEW.first_registration_date, 'yy'), trim(replace(to_char(NEW.unicef_id_index,'0000,0000'),',','.')));
          return NEW;
        end
        $$;
        """,
        ),
        migrations.RunSQL(
            "UPDATE household_household SET unicef_id = format('HH-%s-%s',TO_CHAR(first_registration_date, 'yy') ,trim(replace(to_char(unicef_id_index,'0000,0000'),',','.')))"
        ),
    ]
