# Generated by Django 2.2.16 on 2021-12-07 12:10

from django.db import migrations, models


def change_tp_statuses(apps, schema_editor):
    TargetPopulation = apps.get_model("targeting", "TargetPopulation")

    for tp in TargetPopulation.objects.filter(status="FINALIZED"):
        tp.status = "READY_FOR_CASH_ASSIST" if tp.sent_to_datahub else "PROCESSING"
        tp.save()


def revert_change_tp_statuses(apps, schema_editor):
    TargetPopulation = apps.get_model("targeting", "TargetPopulation")

    for tp in TargetPopulation.objects.filter(status__in=["PROCESSING", "READY_FOR_CASH_ASSIST"]):
        tp.status = "FINALIZED"
        tp.save()


class Migration(migrations.Migration):

    dependencies = [
        ('targeting', '0026_migration'),
    ]

    operations = [
        migrations.AlterField(
            model_name='targetpopulation',
            name='status',
            field=models.CharField(choices=[('DRAFT', 'Open'), ('LOCKED', 'Locked'), ('PROCESSING', 'Processing'), ('READY_FOR_CASH_ASSIST', 'Ready for cash assist')], db_index=True, default='DRAFT', max_length=256),
        ),
        migrations.RunPython(change_tp_statuses, migrations.RunPython.noop)
    ]
